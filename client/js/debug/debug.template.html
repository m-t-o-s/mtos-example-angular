<div class="debug">

  <h2 ng-if="debug.keypair">Server Key: {{debug.keypair.publicKeyFingerprint | emojiprint}}</h2>

  <div class="identites">
    <h2>Your Identities</h2>

    <form>
      <input ng-model="debug.newUser.username" placeholder="User Name" required />
      <input ng-model="debug.newUser.passphrase" placeholder="Pass Phrase" required />
      <button ng-click="debug.addUser()">Add User</button>
    </form>

    <ul ng-if="debug.users">
      <li ng-repeat="user in debug.users">
        <button ng-if="user.keypair.publicKey" ng-click="debug.createArchive({user: {mtID: user.mtID, username: user.username, publicKeyString: user.keypair.publicKeyString, publicKeyFingerprint: user.keypair.publicKeyFingerprint}})">Export</button>
        <p>{{user.username}}</p>
        <p>{{user.keypair.publicKeyFingerprint | emojiprint}}</p>
        <form ng-if="!user.keypair.publicKey">
          <input ng-model="debug.passphrases[user.mtID]" />
          <button ng-click="debug.unlockUser(user.mtID)">Unlock</button>
        </form>
      </li>
    </ul>
    <form>
      Active user:
      <select ng-model="debug.activeUser" ng-options="user.mtID as user.username for user in debug.authenticatedUsers"></select>
    </form>
  </div>

  <div class="debug-data">
    <h2>Send a Message</h2>
    <div class="debug-input">
      <form>
        <textarea ng-model="debug.data"></textarea>
        <br />
        <select ng-model="debug.subscriptions" ng-options="user.mtID as user.username for user in debug.subscribers"></select>
        <button ng-click="debug.sendMessage()">Send Message</button>
      </form>
    </div>
    <div class="debug-output">
      <pre>{{debug.parsedData | json}}</pre>
    </div>
  </div>

  <div class="pubsub">
    <h2>Your Subscribers</h2>
      Add Subscriber:
    <input type="file" fileread="debug.addThisSubscriber" />
    <ul>
      <li ng-repeat="user in debug.subscribers">
        <button ng-if="user.keypair.publicKey" ng-click="debug.createArchive({user: {mtID: user.mtID, username: user.username, publicKeyString: user.keypair.publicKeyString, publicKeyFingerprint: user.keypair.publicKeyFingerprint}})">Export</button>
        <p>{{user.username}}</p>
        <p>{{user.publicKeyFingerprint | emojiprint}}</p>
      </li>
    </ul>
  </div>

  <div class="debug-backups">
    <h2>Backup Management</h2>

    <button ng-click="debug.createArchive()">Create Archive</button>
    <br />
    <input type="file" fileread="debug.backupFile" />
  </div>
</div>

<ul>
  <li ng-repeat="torrent in debug.webTorrent.client.torrents">
    <p>{{torrent.name}}</p>
    <ul>
      <li ng-repeat="file in torrent.files">
        <p>{{file.name}}</p>
      </li>
    </ul>
  </li>
</ul>
